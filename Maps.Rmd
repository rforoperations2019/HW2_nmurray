---
title: "Hw2"
author: "Nora Murray"
date: "October 3, 2019"
output: html_document
---
```{r setup, include=FALSE}
require(rgdal)
require(leaflet)
require(leaflet.extras)

require(dplyr)
require(readxl)
require(stringr)
require(geojsonio)
library(RColorBrewer)
library(tidycensus)
library(tigris)

```
```
```
# Load Data for Point Base Map: Mobile Home Data

```{r}
# Load mobile home data

mobile_home_df <- data.frame(read.csv("Mobile_Home_Parks.csv"))

#Subset NY Data 

mobile_home_ny <- subset(mobile_home_df, STATE == "NY")

#Data Exploration

dim(mobile_home_ny)
names(mobile_home_ny)

```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.

# Marker Point Map
```{

```{r}
```{r}
# Load mobile home data
pal <- colorFactor(c("mediumturquoise",  "purple" , "cadetblue4" ), domain = c("LARGE (>100)", "MEDIUM (51-100)","SMALL (<50)"))

basemap_points <-leaflet(mobile_home_ny) %>%
  # Basemaps
  addTiles()%>%
  addProviderTiles("Esri.WorldPhysical", group = "WorldPhysical") %>%
  addCircleMarkers(group = mobile_home_ny$SIZE, stroke = F, color = ~pal(SIZE), weight = 100,
                   fillOpacity = 0.5) %>%
    addLayersControl(
    baseGroups = c("OSM (default)", "WorldPhysical"),
    overlayGroups = c(levels(mobile_home_ny$SIZE)),
    options = layersControlOptions(collapsed = FALSE))%>%
   addLegend("bottomright", pal = pal, values = ~SIZE,
    title = "Size of Mobile Home Community")

basemap_points %>% 
  fitBounds(-78, 45, -72, 40) # Fit to NY

```

# Data from : https://hifld-geoplatform.opendata.arcgis.com/datasets/public-transit-routes/data?geometry=-104.352%2C31.109%2C-57.023%2C43.309

# Public Transit Data from DHS

Plot is limited to those Traffic Authorities that operate under the authroirt of NY 

```{r}
# LINE PLOT

# Load Shape File 
public_transit <- readOGR("Public_Transit_Routes.shp")

# Limit to NY Transit Systems
ny_lines <- c("METRO-NORTH COMMUTER RAILROAD COMPANY, DBA: MTA METRO-NORTH RAILROAD",  
              "MTA LONG ISLAND RAIL ROAD",                                                                  
              "MTA NEW YORK CITY TRANSIT",                                                                  
              "NIAGARA FRONTIER TRANSPORTATION AUTHORITY",                                                  
              "PORT AUTHORITY OF NEW YORK AND NEW JERSEY",                                                  
              "PORT AUTHORITY TRANS-HUDSON CORPORATION",                                                    
              "STATEN ISLAND RAPID TRANSIT OPERATING AUTHORITY, DBA: MTA STATEN ISLAND RAILWAY")

public_transit_ne <- subset(public_transit, public_transit$SYS_AGENCY %in% ne_lines)

#Create Color Pallette

cols <- colorRampPalette(brewer.pal(8,"Dark2"))(length(ny_lines))
pal2 <-colorFactor(cols, domain = ny_lines)

leaflet(data = public_transit_ne) %>%
  # Basemaps
  addTiles() %>%
  addProviderTiles("Esri.WorldGrayCanvas", group = "WorldGrayCanvas") %>%
  addProviderTiles("Esri.WorldTerrain", group = "WorldTerrain") %>%
  addPolylines(group = public_transit_ne$SYS_AGENCY, color = ~pal2(SYS_AGENCY))  %>%
  # Layers control
  addLayersControl(
    baseGroups = c("WorldGrayCanvas", "WorldTerrain"),
    # overlayGroups = ne_lines,
    # position = "bottomleft",
    options = layersControlOptions(collapsed = FALSE)) %>%
   addLegend("topright", pal = pal2, values = ~SYS_AGENCY,
    title = "Public Transit Lines By System")  %>%
    fitBounds(-79, 45, -72, 39) # Fit to Northeast


                 

```

# Polygon Map with 2 Layers 

#Prep the data and add shapefile 

```{r}
# Source: https://walkerke.github.io/tidycensus/reference/load_variables.html
# Get the data from the census

v17 <- load_variables(2017, "acs5", cache = TRUE)

# Vehicle Ownership 
ny_data_car <- get_acs(geography = "county", 
                       variables = c("B08541_006"),
                       state = 36,
                       geometry = FALSE)
# Population
ny_data_pop <- get_acs(geography = "county", 
                       variables = c("B01003_001"),
                       state = 36,
                       geometry = FALSE)

# Get NYS county shapefile 
ny_counties <- counties(state = 36)


# Merge Car and Population data files 

poly_map_data <- merge(ny_data_car, ny_data_pop, by = c("GEOID", "NAME"), sort = FALSE)

# ny_counties@data<- merge(ny_counties@data, poly_map_data, by = "GEOID", sort = FALSE)

#Merge Car and Shapefile data
cars_ny <- merge(ny_counties, ny_data_car, by = c("GEOID"))


# Recall Varible x is car data and variable.y is population data 


```
# Time to Plot! Polygon Map

```{r}

# Solution
# pal <- colorNumeric(
#   palette = "Blues",
#   domain = ny_counties$variable.x)

leaflet(data = cars_ny) %>%
  addTiles() %>%
  addProviderTiles("Esri.WorldGrayCanvas", group = "WorldGrayCanvas") %>%
  addProviderTiles("CartoDB.Positron", group = "Positron") %>%
      addLayersControl(
    baseGroups = c("WorldGrayCanvas", "Positron"),
    options = layersControlOptions(collapsed = FALSE)) %>%
    fitBounds(-79, 45, -72, 39) # Fit to Northeast

```

